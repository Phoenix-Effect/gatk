# Workflow for calling germline SNP and indel variants using GATK HaplotypeCaller.

configfile: "TCGA_LIHC_v1.11.config.json"

# Tools
GATK = "gatk" # Path to GATK v3.5 .jar file. GATK needs to be installed to the conda environment with gatk-register /path/to/GATK.jar
BGZIP = "bgzip"
TABIX = "tabix"

# Reference files: reference genome sequences in FASTA format, index .fa.fai
# files created with Samtools faidx, sequence dictionary .dict files created
# with Picard CreateSequenceDictionary
REF = config["GRCh38_wholegenome_ref_path"]
REF_FA_INDEX = config["GRCh38_wholegenome_ref_index_path"] # Reference FASTA index file (.fa.fai)

# Database and interval files. Chromosome notation and names must match those
# in the input and reference files. As GATK does not currently support VCF
# version 4.2, VCF files must be formatted according to version 4.1.
DBSNP = config["dbsnp_vcf"] # Tabix indexed, bgzipped dbSNP VCF
COSMIC = config["dbcosmic_vcf"] # Tabix indexed, bgzipped COSMIC VCF
XX_INTERVAL_LIST = config["XX_interval_list"]
XY_INTERVAL_LIST = config["XY_interval_list"]
PARTIAL_1_2_3_INTERVAL_LIST = config["1_2_3_interval_list"]
PARTIAL_4_5_6_INTERVAL_LIST = config["4_5_6_interval_list"]
PARTIAL_7_8_9_10_INTERVAL_LIST = config["7_8_9_10_interval_list"]
PARTIAL_11_12_13_14_INTERVAL_LIST = config["11_12_13_14_interval_list"]
PARTIAL_15_16_17_18_INTERVAL_LIST = config["15_16_17_18_interval_list"]
PARTIAL_19_20_21_22_INTERVAL_LIST = config["19_20_21_22_interval_list"]
PARTIAL_XY_INTERVAL_LIST = config["XY_only_interval_list"]
PARTIAL_X_INTERVAL_LIST = config["X_interval_list"]
CHR1_INTERVAL_LIST = config["1_interval_list"]
CHR2_INTERVAL_LIST = config["2_interval_list"]
CHR3_INTERVAL_LIST = config["3_interval_list"]
CHR4_INTERVAL_LIST = config["4_interval_list"]
CHR5_INTERVAL_LIST = config["5_interval_list"]
CHR6_INTERVAL_LIST = config["6_interval_list"]
CHR7_INTERVAL_LIST = config["7_interval_list"]
CHR8_INTERVAL_LIST = config["8_interval_list"]
CHR9_INTERVAL_LIST = config["9_interval_list"]
CHR10_INTERVAL_LIST = config["10_interval_list"]
CHR11_INTERVAL_LIST = config["11_interval_list"]
CHR12_INTERVAL_LIST = config["12_interval_list"]
CHR13_INTERVAL_LIST = config["13_interval_list"]
CHR14_INTERVAL_LIST = config["14_interval_list"]
CHR15_INTERVAL_LIST = config["15_interval_list"]
CHR16_INTERVAL_LIST = config["16_interval_list"]
CHR17_INTERVAL_LIST = config["17_interval_list"]
CHR18_INTERVAL_LIST = config["18_interval_list"]
CHR19_INTERVAL_LIST = config["19_interval_list"]
CHR20_INTERVAL_LIST = config["20_interval_list"]
CHR21_INTERVAL_LIST = config["21_interval_list"]
CHR22_INTERVAL_LIST = config["22_interval_list"]
CHRX_INTERVAL_LIST = config["X_interval_list"]
CHRY_INTERVAL_LIST = config["Y_interval_list"]


# Directories
BAM_DIR = "/mnt/storage/CANCER_DOWNLOADS/PROCESSED/TCGA_LIHC/WES/GRCh38_sorted_BAM/"
VCF_DIR = "/mnt/storage/CANCER_DOWNLOADS/PROCESSED/TCGA_LIHC/WES/gVCFs/"

# Samples

# Position sorted BAM alignment files.
# Formatting BAM file name lists into strings to use in shell commands.
#NORMAL_BAMS = config["TCGA_LIHC_WES_normal_BAMs"]
#NORMAL_BAMS_str = " ".join(NORMAL_BAMS)
#TUMOR_BAMS = config["TCGA_LIHC_WES_tumor_BAMs"]
#TUMOR_BAMS_str = " ".join(TUMOR_BAMS)
TCGA_LIHC_WES_normal_female_samples = config["TCGA_LIHC_WES_normal_female_samples"]
TCGA_LIHC_WES_normal_male_samples = config["TCGA_LIHC_WES_normal_male_samples"]
TCGA_LIHC_WES_paired_tumor_adjacent_female_samples = config["TCGA_LIHC_WES_paired_tumor_adjacent_female_samples"]
TCGA_LIHC_WES_paired_tumor_adjacent_male_samples = config["TCGA_LIHC_WES_paired_tumor_adjacent_male_samples"]

#GATK_BAM_LIST = []

#for item in NORMAL_BAMS:
#	gatk_list_item = "-I " + BAM_DIR + item
#	GATK_BAM_LIST.append(gatk_list_item)

NORMAL_FEMALE_BAMS = []
NORMAL_FEMALE_SAMPLES = config["TCGA_LIHC_WES_normal_female_samples"]
# TCGA-FV-A496-11A-12D-A25V-10_WES_XX
for item in NORMAL_FEMALE_SAMPLES:
	normal_female_bam_listitem = BAM_DIR + item + ".bam"
	NORMAL_FEMALE_BAMS.append(normal_female_bam_listitem)

GATK_GVCF_LIST = []
NORMAL_GVCFS = config["TCGA_LIHC_WES_normal_gVCFs"]
for item in NORMAL_GVCFS:
	gvcf_list_item = "--variant " + VCF_DIR + item
	GATK_GVCF_LIST.append(gvcf_list_item)

GATK_GVCF_LIST_str = " ".join(GATK_GVCF_LIST)

GATK_MALE_GVCF_LIST = []
NORMAL_GVCFS = config["TCGA_LIHC_WES_normal_male_gVCFs"]
for item in NORMAL_GVCFS:
	gvcf_list_item = "--variant " + VCF_DIR + item
	GATK_MALE_GVCF_LIST.append(gvcf_list_item)

GATK_MALE_GVCF_LIST_str = " ".join(GATK_MALE_GVCF_LIST)

GATK_FEMALE_GVCF_LIST = []
NORMAL_GVCFS = config["TCGA_LIHC_WES_normal_female_gVCFs"]
for item in NORMAL_GVCFS:
	gvcf_list_item = "--variant " + VCF_DIR + item
	GATK_FEMALE_GVCF_LIST.append(gvcf_list_item)

GATK_FEMALE_GVCF_LIST_str = " ".join(GATK_FEMALE_GVCF_LIST)

rule all:
	input:
		#expand(VCF_DIR + "{sample}_rawLikehoods.g.vcf", VCF_DIR=VCF_DIR, sample=TCGA_LIHC_WES_normal_female_samples),
		#expand(VCF_DIR + "{sample}_rawLikehoods.g.vcf", VCF_DIR=VCF_DIR, sample=TCGA_LIHC_WES_normal_male_samples),
		#VCF_DIR + "TCGA_LIHC_adjacent_female_genotype_gvcfs.vcf",
		# VCF_DIR + "TCGA_LIHC_adjacent_male_genotype_gvcfs_chr1.vcf",
		# VCF_DIR + "TCGA_LIHC_adjacent_male_genotype_gvcfs_chr2.vcf",
		# VCF_DIR + "TCGA_LIHC_adjacent_male_genotype_gvcfs_chr3.vcf",
		# VCF_DIR + "TCGA_LIHC_adjacent_male_genotype_gvcfs_chr4to6.vcf",
		# VCF_DIR + "TCGA_LIHC_adjacent_male_genotype_gvcfs_chr7to10.vcf",
		# VCF_DIR + "TCGA_LIHC_adjacent_male_genotype_gvcfs_chr11to14.vcf",
		# VCF_DIR + "TCGA_LIHC_adjacent_male_genotype_gvcfs_chr15to18.vcf",
		# VCF_DIR + "TCGA_LIHC_adjacent_male_genotype_gvcfs_chr19to22.vcf",
		# VCF_DIR + "TCGA_LIHC_adjacent_male_genotype_gvcfs_chrXtoY.vcf",


rule gatk_haplotypecaller_male_gvcf:
	input:
		BAM = lambda wildcards: BAM_DIR + wildcards.sample + "_HISAT2_aligned_sortedbycoord_wRGs_rmDups_BQcalib.bam",
		REF = REF,
		INTERVALS = XY_INTERVAL_LIST,
		DBSNP = DBSNP
	output:
		VCF = VCF_DIR + "{sample}_rawLikehoods.g.vcf"
	params:
		xmx = "48g",
		xms = "48g",
		threads = "16",
		min_pruning = 2,
		heterozygosity=0.001, # Heterozygosity value used to compute prior likelihoods for any locus
		indel_heterozygosity=1.25E-4, # Heterozygosity for indel calling
		maxReadsInRegionPerSample=10000, # Maximum reads in an active region
		min_base_quality_score=10, # Minimum base quality required to consider a base for calling
		minReadsPerAlignmentStart=10, # Minimum number of reads sharing the same alignment start for each genomic location in an active region
		sample_ploidy=2, # Ploidy per sample. For pooled data, set to (Number of samples in each pool * Sample Ploidy)
		standard_min_confidence_threshold_for_calling=10.0, # The minimum phred-scaled confidence threshold at which variants should be called
		max_alternate_alleles=6, # Maximum number of alternate alleles to genotype
		output_mode="EMIT_ALL_CONFIDENT_SITES" # Which type of calls we should output: EMIT_VARIANTS_ONLY, EMIT_ALL_SITES
	message: "Calculating genotype likelihoods from {input.BAM} using GATK HaplotypeCaller"
	shell:
		"""
		gatk \
		-Xmx{params.xmx} \
		-Xms{params.xms} \
		-nct {params.threads} \
		-ERC GVCF \
		-R {input.REF} \
		-T HaplotypeCaller \
		-I {input.BAM} \
		--minPruning {params.min_pruning} \
		--heterozygosity {params.heterozygosity} \
		--indel_heterozygosity {params.indel_heterozygosity} \
		--maxReadsInRegionPerSample {params.maxReadsInRegionPerSample} \
		--min_base_quality_score {params.min_base_quality_score} \
		--minReadsPerAlignmentStart {params.minReadsPerAlignmentStart} \
		--sample_ploidy {params.sample_ploidy} \
		--standard_min_confidence_threshold_for_calling {params.standard_min_confidence_threshold_for_calling} \
		--max_alternate_alleles {params.max_alternate_alleles} \
		--filter_reads_with_N_cigar \
		--output_mode {params.output_mode} \
		--dbsnp {input.DBSNP} \
		-L {input.INTERVALS} \
		-o {output.VCF}
		"""

rule gatk_haplotypecaller_female_gvcf:
	input:
		BAM = lambda wildcards: BAM_DIR + wildcards.sample + "_HISAT2_aligned_sortedbycoord_wRGs_rmDups_BQcalib.bam",
		REF = REF,
		INTERVALS = XX_INTERVAL_LIST,
		DBSNP = DBSNP
	output:
		VCF = VCF_DIR + "{sample}_rawLikehoods.g.vcf"
	params:
		xmx = "48g",
		xms = "48g",
		threads = "16",
		min_pruning = 2,
		heterozygosity=0.001, # Heterozygosity value used to compute prior likelihoods for any locus
		indel_heterozygosity=1.25E-4, # Heterozygosity for indel calling
		maxReadsInRegionPerSample=10000, # Maximum reads in an active region
		min_base_quality_score=10, # Minimum base quality required to consider a base for calling
		minReadsPerAlignmentStart=10, # Minimum number of reads sharing the same alignment start for each genomic location in an active region
		sample_ploidy=2, # Ploidy per sample. For pooled data, set to (Number of samples in each pool * Sample Ploidy)
		standard_min_confidence_threshold_for_calling=10.0, # The minimum phred-scaled confidence threshold at which variants should be called
		max_alternate_alleles=6, # Maximum number of alternate alleles to genotype
		output_mode="EMIT_ALL_CONFIDENT_SITES" # Which type of calls we should output: EMIT_VARIANTS_ONLY, EMIT_ALL_SITES
	message: "Calculating genotype likelihoods from {input.BAM} using GATK HaplotypeCaller"
	shell:
		"""
		gatk \
		-Xmx{params.xmx} \
		-Xms{params.xms} \
		-nct {params.threads} \
		-ERC GVCF \
		-R {input.REF} \
		-T HaplotypeCaller \
		-I {input.BAM} \
		--minPruning {params.min_pruning} \
		--heterozygosity {params.heterozygosity} \
		--indel_heterozygosity {params.indel_heterozygosity} \
		--maxReadsInRegionPerSample {params.maxReadsInRegionPerSample} \
		--min_base_quality_score {params.min_base_quality_score} \
		--minReadsPerAlignmentStart {params.minReadsPerAlignmentStart} \
		--sample_ploidy {params.sample_ploidy} \
		--standard_min_confidence_threshold_for_calling {params.standard_min_confidence_threshold_for_calling} \
		--max_alternate_alleles {params.max_alternate_alleles} \
		--filter_reads_with_N_cigar \
		--output_mode {params.output_mode} \
		--dbsnp {input.DBSNP} \
		-L {input.INTERVALS} \
		-o {output.VCF}
		"""

rule genotype_male_gvcfs_chr1:
	input:
		REF = REF,
		INTERVALS = CHR1_INTERVAL_LIST
	output:
		VCF = VCF_DIR + "TCGA_LIHC_adjacent_male_genotype_gvcfs_chr1.vcf"
	params:
		GVCF_LIST = GATK_MALE_GVCF_LIST_str,
		xmx = "98g",
		xms = "98g",
		threads = "24",
		heterozygosity=0.001, # Heterozygosity value used to compute prior likelihoods for any locus
		indel_heterozygosity=1.25E-4, # Heterozygosity for indel calling
		sample_ploidy=2, # Ploidy per sample. For pooled data, set to (Number of samples in each pool * Sample Ploidy)
		standard_min_confidence_threshold_for_calling=10.0, # The minimum phred-scaled confidence threshold at which variants should be called
		max_alternate_alleles=6, # Maximum number of alternate alleles to genotype
	message: "Merging gVCF records."
	shell:
		"""
		gatk \
		-Xmx{params.xmx} \
		-Xms{params.xms} \
		-R {input.REF} \
		-T GenotypeGVCFs \
		{params.GVCF_LIST} \
		--heterozygosity {params.heterozygosity} \
		--indel_heterozygosity {params.indel_heterozygosity} \
		--sample_ploidy {params.sample_ploidy} \
		--standard_min_confidence_threshold_for_calling {params.standard_min_confidence_threshold_for_calling} \
		--max_alternate_alleles {params.max_alternate_alleles} \
		--filter_reads_with_N_cigar \
		-L {input.INTERVALS} \
		--disable_auto_index_creation_and_locking_when_reading_rods \
		-o {output.VCF}
		"""

rule genotype_male_gvcfs_chr2:
	input:
		REF = REF,
		INTERVALS = CHR2_INTERVAL_LIST
	output:
		VCF = VCF_DIR + "TCGA_LIHC_adjacent_male_genotype_gvcfs_chr2.vcf"
	params:
		GVCF_LIST = GATK_MALE_GVCF_LIST_str,
		xmx = "98g",
		xms = "98g",
		threads = "24",
		heterozygosity=0.001, # Heterozygosity value used to compute prior likelihoods for any locus
		indel_heterozygosity=1.25E-4, # Heterozygosity for indel calling
		sample_ploidy=2, # Ploidy per sample. For pooled data, set to (Number of samples in each pool * Sample Ploidy)
		standard_min_confidence_threshold_for_calling=10.0, # The minimum phred-scaled confidence threshold at which variants should be called
		max_alternate_alleles=6, # Maximum number of alternate alleles to genotype
	message: "Merging gVCF records."
	shell:
		"""
		gatk \
		-Xmx{params.xmx} \
		-Xms{params.xms} \
		-R {input.REF} \
		-T GenotypeGVCFs \
		{params.GVCF_LIST} \
		--heterozygosity {params.heterozygosity} \
		--indel_heterozygosity {params.indel_heterozygosity} \
		--sample_ploidy {params.sample_ploidy} \
		--standard_min_confidence_threshold_for_calling {params.standard_min_confidence_threshold_for_calling} \
		--max_alternate_alleles {params.max_alternate_alleles} \
		--filter_reads_with_N_cigar \
		-L {input.INTERVALS} \
		--disable_auto_index_creation_and_locking_when_reading_rods \
		-o {output.VCF}
		"""

rule genotype_male_gvcfs_chr3:
	input:
		REF = REF,
		INTERVALS = CHR3_INTERVAL_LIST
	output:
		VCF = VCF_DIR + "TCGA_LIHC_adjacent_male_genotype_gvcfs_chr3.vcf"
	params:
		GVCF_LIST = GATK_MALE_GVCF_LIST_str,
		xmx = "98g",
		xms = "98g",
		threads = "24",
		heterozygosity=0.001, # Heterozygosity value used to compute prior likelihoods for any locus
		indel_heterozygosity=1.25E-4, # Heterozygosity for indel calling
		sample_ploidy=2, # Ploidy per sample. For pooled data, set to (Number of samples in each pool * Sample Ploidy)
		standard_min_confidence_threshold_for_calling=10.0, # The minimum phred-scaled confidence threshold at which variants should be called
		max_alternate_alleles=6, # Maximum number of alternate alleles to genotype
	message: "Merging gVCF records."
	shell:
		"""
		gatk \
		-Xmx{params.xmx} \
		-Xms{params.xms} \
		-R {input.REF} \
		-T GenotypeGVCFs \
		{params.GVCF_LIST} \
		--heterozygosity {params.heterozygosity} \
		--indel_heterozygosity {params.indel_heterozygosity} \
		--sample_ploidy {params.sample_ploidy} \
		--standard_min_confidence_threshold_for_calling {params.standard_min_confidence_threshold_for_calling} \
		--max_alternate_alleles {params.max_alternate_alleles} \
		--filter_reads_with_N_cigar \
		-L {input.INTERVALS} \
		--disable_auto_index_creation_and_locking_when_reading_rods \
		-o {output.VCF}
		"""

rule genotype_male_gvcfs_part2:
	input:
		REF = REF,
		INTERVALS = PARTIAL_4_5_6_INTERVAL_LIST
	output:
		VCF = VCF_DIR + "TCGA_LIHC_adjacent_male_genotype_gvcfs_chr4to6.vcf"
	params:
		GVCF_LIST = GATK_MALE_GVCF_LIST_str,
		xmx = "98g",
		xms = "98g",
		threads = "24",
		heterozygosity=0.001, # Heterozygosity value used to compute prior likelihoods for any locus
		indel_heterozygosity=1.25E-4, # Heterozygosity for indel calling
		sample_ploidy=2, # Ploidy per sample. For pooled data, set to (Number of samples in each pool * Sample Ploidy)
		standard_min_confidence_threshold_for_calling=10.0, # The minimum phred-scaled confidence threshold at which variants should be called
		max_alternate_alleles=6, # Maximum number of alternate alleles to genotype
	message: "Merging gVCF records."
	shell:
		"""
		gatk \
		-Xmx{params.xmx} \
		-Xms{params.xms} \
		-R {input.REF} \
		-T GenotypeGVCFs \
		{params.GVCF_LIST} \
		--heterozygosity {params.heterozygosity} \
		--indel_heterozygosity {params.indel_heterozygosity} \
		--sample_ploidy {params.sample_ploidy} \
		--standard_min_confidence_threshold_for_calling {params.standard_min_confidence_threshold_for_calling} \
		--max_alternate_alleles {params.max_alternate_alleles} \
		--filter_reads_with_N_cigar \
		-L {input.INTERVALS} \
		-o {output.VCF}
		"""

rule genotype_male_gvcfs_part3:
	input:
		REF = REF,
		INTERVALS = PARTIAL_7_8_9_10_INTERVAL_LIST
	output:
		VCF = VCF_DIR + "TCGA_LIHC_adjacent_male_genotype_gvcfs_chr7to10.vcf"
	params:
		GVCF_LIST = GATK_MALE_GVCF_LIST_str,
		xmx = "98g",
		xms = "98g",
		threads = "24",
		heterozygosity=0.001, # Heterozygosity value used to compute prior likelihoods for any locus
		indel_heterozygosity=1.25E-4, # Heterozygosity for indel calling
		sample_ploidy=2, # Ploidy per sample. For pooled data, set to (Number of samples in each pool * Sample Ploidy)
		standard_min_confidence_threshold_for_calling=10.0, # The minimum phred-scaled confidence threshold at which variants should be called
		max_alternate_alleles=6, # Maximum number of alternate alleles to genotype
	message: "Merging gVCF records."
	shell:
		"""
		gatk \
		-Xmx{params.xmx} \
		-Xms{params.xms} \
		-R {input.REF} \
		-T GenotypeGVCFs \
		{params.GVCF_LIST} \
		--heterozygosity {params.heterozygosity} \
		--indel_heterozygosity {params.indel_heterozygosity} \
		--sample_ploidy {params.sample_ploidy} \
		--standard_min_confidence_threshold_for_calling {params.standard_min_confidence_threshold_for_calling} \
		--max_alternate_alleles {params.max_alternate_alleles} \
		--filter_reads_with_N_cigar \
		-L {input.INTERVALS} \
		-o {output.VCF}
		"""

rule genotype_male_gvcfs_part4:
	input:
		REF = REF,
		INTERVALS = PARTIAL_11_12_13_14_INTERVAL_LIST
	output:
		VCF = VCF_DIR + "TCGA_LIHC_adjacent_male_genotype_gvcfs_chr11to14.vcf"
	params:
		GVCF_LIST = GATK_MALE_GVCF_LIST_str,
		xmx = "98g",
		xms = "98g",
		threads = "24",
		heterozygosity=0.001, # Heterozygosity value used to compute prior likelihoods for any locus
		indel_heterozygosity=1.25E-4, # Heterozygosity for indel calling
		sample_ploidy=2, # Ploidy per sample. For pooled data, set to (Number of samples in each pool * Sample Ploidy)
		standard_min_confidence_threshold_for_calling=10.0, # The minimum phred-scaled confidence threshold at which variants should be called
		max_alternate_alleles=6, # Maximum number of alternate alleles to genotype
	message: "Merging gVCF records."
	shell:
		"""
		gatk \
		-Xmx{params.xmx} \
		-Xms{params.xms} \
		-R {input.REF} \
		-T GenotypeGVCFs \
		{params.GVCF_LIST} \
		--heterozygosity {params.heterozygosity} \
		--indel_heterozygosity {params.indel_heterozygosity} \
		--sample_ploidy {params.sample_ploidy} \
		--standard_min_confidence_threshold_for_calling {params.standard_min_confidence_threshold_for_calling} \
		--max_alternate_alleles {params.max_alternate_alleles} \
		--filter_reads_with_N_cigar \
		-L {input.INTERVALS} \
		-o {output.VCF}
		"""


rule genotype_male_gvcfs_part5:
	input:
		REF = REF,
		INTERVALS = PARTIAL_15_16_17_18_INTERVAL_LIST
	output:
		VCF = VCF_DIR + "TCGA_LIHC_adjacent_male_genotype_gvcfs_chr15to18.vcf"
	params:
		GVCF_LIST = GATK_MALE_GVCF_LIST_str,
		xmx = "98g",
		xms = "98g",
		threads = "24",
		heterozygosity=0.001, # Heterozygosity value used to compute prior likelihoods for any locus
		indel_heterozygosity=1.25E-4, # Heterozygosity for indel calling
		sample_ploidy=2, # Ploidy per sample. For pooled data, set to (Number of samples in each pool * Sample Ploidy)
		standard_min_confidence_threshold_for_calling=10.0, # The minimum phred-scaled confidence threshold at which variants should be called
		max_alternate_alleles=6, # Maximum number of alternate alleles to genotype
	message: "Merging gVCF records."
	shell:
		"""
		gatk \
		-Xmx{params.xmx} \
		-Xms{params.xms} \
		-R {input.REF} \
		-T GenotypeGVCFs \
		{params.GVCF_LIST} \
		--heterozygosity {params.heterozygosity} \
		--indel_heterozygosity {params.indel_heterozygosity} \
		--sample_ploidy {params.sample_ploidy} \
		--standard_min_confidence_threshold_for_calling {params.standard_min_confidence_threshold_for_calling} \
		--max_alternate_alleles {params.max_alternate_alleles} \
		--filter_reads_with_N_cigar \
		-L {input.INTERVALS} \
		-o {output.VCF}
		"""

rule genotype_male_gvcfs_part7:
	input:
		REF = REF,
		INTERVALS = PARTIAL_XY_INTERVAL_LIST
	output:
		VCF = VCF_DIR + "TCGA_LIHC_adjacent_male_genotype_gvcfs_chrXtoY.vcf"
	params:
		GVCF_LIST = GATK_MALE_GVCF_LIST_str,
		xmx = "98g",
		xms = "98g",
		threads = "24",
		heterozygosity=0.001, # Heterozygosity value used to compute prior likelihoods for any locus
		indel_heterozygosity=1.25E-4, # Heterozygosity for indel calling
		sample_ploidy=2, # Ploidy per sample. For pooled data, set to (Number of samples in each pool * Sample Ploidy)
		standard_min_confidence_threshold_for_calling=10.0, # The minimum phred-scaled confidence threshold at which variants should be called
		max_alternate_alleles=6, # Maximum number of alternate alleles to genotype
	message: "Merging gVCF records."
	shell:
		"""
		gatk \
		-Xmx{params.xmx} \
		-Xms{params.xms} \
		-R {input.REF} \
		-T GenotypeGVCFs \
		{params.GVCF_LIST} \
		--heterozygosity {params.heterozygosity} \
		--indel_heterozygosity {params.indel_heterozygosity} \
		--sample_ploidy {params.sample_ploidy} \
		--standard_min_confidence_threshold_for_calling {params.standard_min_confidence_threshold_for_calling} \
		--max_alternate_alleles {params.max_alternate_alleles} \
		--filter_reads_with_N_cigar \
		-L {input.INTERVALS} \
		-o {output.VCF}
		"""

rule genotype_female_gvcfs:
	input:
		REF = REF,
		INTERVALS = XX_INTERVAL_LIST
	output:
		VCF = VCF_DIR + "TCGA_LIHC_adjacent_female_genotype_gvcfs.vcf"
	params:
		GVCF_LIST = GATK_FEMALE_GVCF_LIST_str,
		xmx = "62g",
		xms = "62g",
		threads = "24",
		heterozygosity=0.001, # Heterozygosity value used to compute prior likelihoods for any locus
		indel_heterozygosity=1.25E-4, # Heterozygosity for indel calling
		sample_ploidy=2, # Ploidy per sample. For pooled data, set to (Number of samples in each pool * Sample Ploidy)
		standard_min_confidence_threshold_for_calling=10.0, # The minimum phred-scaled confidence threshold at which variants should be called
		max_alternate_alleles=6, # Maximum number of alternate alleles to genotype
	message: "Merging gVCF records."
	shell:
		"""
		gatk \
		-Xmx{params.xmx} \
		-Xms{params.xms} \
		-R {input.REF} \
		-T GenotypeGVCFs \
		{params.GVCF_LIST} \
		--heterozygosity {params.heterozygosity} \
		--indel_heterozygosity {params.indel_heterozygosity} \
		--sample_ploidy {params.sample_ploidy} \
		--standard_min_confidence_threshold_for_calling {params.standard_min_confidence_threshold_for_calling} \
		--max_alternate_alleles {params.max_alternate_alleles} \
		--filter_reads_with_N_cigar \
		-L {input.INTERVALS} \
		-o {output.VCF}
		"""

rule genotype_female_gvcfs_part1:
	input:
		REF = REF,
		INTERVALS = PARTIAL_1_2_3_INTERVAL_LIST
	output:
		VCF = VCF_DIR + "TCGA_LIHC_adjacent_female_genotype_gvcfs_chr1to3.vcf"
	params:
		GVCF_LIST = GATK_MALE_GVCF_LIST_str,
		xmx = "98g",
		xms = "98g",
		threads = "24",
		heterozygosity=0.001, # Heterozygosity value used to compute prior likelihoods for any locus
		indel_heterozygosity=1.25E-4, # Heterozygosity for indel calling
		sample_ploidy=2, # Ploidy per sample. For pooled data, set to (Number of samples in each pool * Sample Ploidy)
		standard_min_confidence_threshold_for_calling=10.0, # The minimum phred-scaled confidence threshold at which variants should be called
		max_alternate_alleles=6, # Maximum number of alternate alleles to genotype
	message: "Merging gVCF records."
	shell:
		"""
		gatk \
		-Xmx{params.xmx} \
		-Xms{params.xms} \
		-R {input.REF} \
		-T GenotypeGVCFs \
		{params.GVCF_LIST} \
		--heterozygosity {params.heterozygosity} \
		--indel_heterozygosity {params.indel_heterozygosity} \
		--sample_ploidy {params.sample_ploidy} \
		--standard_min_confidence_threshold_for_calling {params.standard_min_confidence_threshold_for_calling} \
		--max_alternate_alleles {params.max_alternate_alleles} \
		--filter_reads_with_N_cigar \
		-L {input.INTERVALS} \
		-o {output.VCF}
		"""

rule genotype_female_gvcfs_part2:
	input:
		REF = REF,
		INTERVALS = PARTIAL_4_5_6_INTERVAL_LIST
	output:
		VCF = VCF_DIR + "TCGA_LIHC_adjacent_female_genotype_gvcfs_chr4to6.vcf"
	params:
		GVCF_LIST = GATK_MALE_GVCF_LIST_str,
		xmx = "98g",
		xms = "98g",
		threads = "24",
		heterozygosity=0.001, # Heterozygosity value used to compute prior likelihoods for any locus
		indel_heterozygosity=1.25E-4, # Heterozygosity for indel calling
		sample_ploidy=2, # Ploidy per sample. For pooled data, set to (Number of samples in each pool * Sample Ploidy)
		standard_min_confidence_threshold_for_calling=10.0, # The minimum phred-scaled confidence threshold at which variants should be called
		max_alternate_alleles=6, # Maximum number of alternate alleles to genotype
	message: "Merging gVCF records."
	shell:
		"""
		gatk \
		-Xmx{params.xmx} \
		-Xms{params.xms} \
		-R {input.REF} \
		-T GenotypeGVCFs \
		{params.GVCF_LIST} \
		--heterozygosity {params.heterozygosity} \
		--indel_heterozygosity {params.indel_heterozygosity} \
		--sample_ploidy {params.sample_ploidy} \
		--standard_min_confidence_threshold_for_calling {params.standard_min_confidence_threshold_for_calling} \
		--max_alternate_alleles {params.max_alternate_alleles} \
		--filter_reads_with_N_cigar \
		-L {input.INTERVALS} \
		-o {output.VCF}
		"""

rule genotype_female_gvcfs_part3:
	input:
		REF = REF,
		INTERVALS = PARTIAL_7_8_9_10_INTERVAL_LIST
	output:
		VCF = VCF_DIR + "TCGA_LIHC_adjacent_female_genotype_gvcfs_chr7to10.vcf"
	params:
		GVCF_LIST = GATK_MALE_GVCF_LIST_str,
		xmx = "98g",
		xms = "98g",
		threads = "24",
		heterozygosity=0.001, # Heterozygosity value used to compute prior likelihoods for any locus
		indel_heterozygosity=1.25E-4, # Heterozygosity for indel calling
		sample_ploidy=2, # Ploidy per sample. For pooled data, set to (Number of samples in each pool * Sample Ploidy)
		standard_min_confidence_threshold_for_calling=10.0, # The minimum phred-scaled confidence threshold at which variants should be called
		max_alternate_alleles=6, # Maximum number of alternate alleles to genotype
	message: "Merging gVCF records."
	shell:
		"""
		gatk \
		-Xmx{params.xmx} \
		-Xms{params.xms} \
		-R {input.REF} \
		-T GenotypeGVCFs \
		{params.GVCF_LIST} \
		--heterozygosity {params.heterozygosity} \
		--indel_heterozygosity {params.indel_heterozygosity} \
		--sample_ploidy {params.sample_ploidy} \
		--standard_min_confidence_threshold_for_calling {params.standard_min_confidence_threshold_for_calling} \
		--max_alternate_alleles {params.max_alternate_alleles} \
		--filter_reads_with_N_cigar \
		-L {input.INTERVALS} \
		-o {output.VCF}
		"""

rule genotype_female_gvcfs_part4:
	input:
		REF = REF,
		INTERVALS = PARTIAL_11_12_13_14_INTERVAL_LIST
	output:
		VCF = VCF_DIR + "TCGA_LIHC_adjacent_female_genotype_gvcfs_chr11to14.vcf"
	params:
		GVCF_LIST = GATK_MALE_GVCF_LIST_str,
		xmx = "98g",
		xms = "98g",
		threads = "24",
		heterozygosity=0.001, # Heterozygosity value used to compute prior likelihoods for any locus
		indel_heterozygosity=1.25E-4, # Heterozygosity for indel calling
		sample_ploidy=2, # Ploidy per sample. For pooled data, set to (Number of samples in each pool * Sample Ploidy)
		standard_min_confidence_threshold_for_calling=10.0, # The minimum phred-scaled confidence threshold at which variants should be called
		max_alternate_alleles=6, # Maximum number of alternate alleles to genotype
	message: "Merging gVCF records."
	shell:
		"""
		gatk \
		-Xmx{params.xmx} \
		-Xms{params.xms} \
		-R {input.REF} \
		-T GenotypeGVCFs \
		{params.GVCF_LIST} \
		--heterozygosity {params.heterozygosity} \
		--indel_heterozygosity {params.indel_heterozygosity} \
		--sample_ploidy {params.sample_ploidy} \
		--standard_min_confidence_threshold_for_calling {params.standard_min_confidence_threshold_for_calling} \
		--max_alternate_alleles {params.max_alternate_alleles} \
		--filter_reads_with_N_cigar \
		-L {input.INTERVALS} \
		-o {output.VCF}
		"""


rule genotype_female_gvcfs_part5:
	input:
		REF = REF,
		INTERVALS = PARTIAL_15_16_17_18_INTERVAL_LIST
	output:
		VCF = VCF_DIR + "TCGA_LIHC_adjacent_female_genotype_gvcfs_chr15to18.vcf"
	params:
		GVCF_LIST = GATK_MALE_GVCF_LIST_str,
		xmx = "98g",
		xms = "98g",
		threads = "24",
		heterozygosity=0.001, # Heterozygosity value used to compute prior likelihoods for any locus
		indel_heterozygosity=1.25E-4, # Heterozygosity for indel calling
		sample_ploidy=2, # Ploidy per sample. For pooled data, set to (Number of samples in each pool * Sample Ploidy)
		standard_min_confidence_threshold_for_calling=10.0, # The minimum phred-scaled confidence threshold at which variants should be called
		max_alternate_alleles=6, # Maximum number of alternate alleles to genotype
	message: "Merging gVCF records."
	shell:
		"""
		gatk \
		-Xmx{params.xmx} \
		-Xms{params.xms} \
		-R {input.REF} \
		-T GenotypeGVCFs \
		{params.GVCF_LIST} \
		--heterozygosity {params.heterozygosity} \
		--indel_heterozygosity {params.indel_heterozygosity} \
		--sample_ploidy {params.sample_ploidy} \
		--standard_min_confidence_threshold_for_calling {params.standard_min_confidence_threshold_for_calling} \
		--max_alternate_alleles {params.max_alternate_alleles} \
		--filter_reads_with_N_cigar \
		-L {input.INTERVALS} \
		-o {output.VCF}
		"""

rule genotype_female_gvcfs_part7:
	input:
		REF = REF,
		INTERVALS = PARTIAL_X_INTERVAL_LIST
	output:
		VCF = VCF_DIR + "TCGA_LIHC_adjacent_female_genotype_gvcfs_chrX.vcf"
	params:
		GVCF_LIST = GATK_MALE_GVCF_LIST_str,
		xmx = "98g",
		xms = "98g",
		threads = "24",
		heterozygosity=0.001, # Heterozygosity value used to compute prior likelihoods for any locus
		indel_heterozygosity=1.25E-4, # Heterozygosity for indel calling
		sample_ploidy=2, # Ploidy per sample. For pooled data, set to (Number of samples in each pool * Sample Ploidy)
		standard_min_confidence_threshold_for_calling=10.0, # The minimum phred-scaled confidence threshold at which variants should be called
		max_alternate_alleles=6, # Maximum number of alternate alleles to genotype
	message: "Merging gVCF records."
	shell:
		"""
		gatk \
		-Xmx{params.xmx} \
		-Xms{params.xms} \
		-R {input.REF} \
		-T GenotypeGVCFs \
		{params.GVCF_LIST} \
		--heterozygosity {params.heterozygosity} \
		--indel_heterozygosity {params.indel_heterozygosity} \
		--sample_ploidy {params.sample_ploidy} \
		--standard_min_confidence_threshold_for_calling {params.standard_min_confidence_threshold_for_calling} \
		--max_alternate_alleles {params.max_alternate_alleles} \
		--filter_reads_with_N_cigar \
		-L {input.INTERVALS} \
		-o {output.VCF}
		"""